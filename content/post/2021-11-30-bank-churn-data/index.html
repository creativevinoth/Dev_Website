---
title: Bank_Churn_Data
author: ''
date: '2021-11-30'
slug: bank-churn-data
categories: []
tags: []
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<pre class="r"><code>summary(Bank_Churn_Data)</code></pre>
<pre><code>##    RowNumber       CustomerId        CreditScore     Geography        
##  Min.   :    1   Min.   :15565701   Min.   :350.0   Length:10000      
##  1st Qu.: 2501   1st Qu.:15628528   1st Qu.:584.0   Class :character  
##  Median : 5000   Median :15690738   Median :652.0   Mode  :character  
##  Mean   : 5000   Mean   :15690941   Mean   :650.5                     
##  3rd Qu.: 7500   3rd Qu.:15753234   3rd Qu.:718.0                     
##  Max.   :10000   Max.   :15815690   Max.   :850.0                     
##     Gender               Age            Tenure          Balance      
##  Length:10000       Min.   :18.00   Min.   : 0.000   Min.   :     0  
##  Class :character   1st Qu.:32.00   1st Qu.: 3.000   1st Qu.:     0  
##  Mode  :character   Median :37.00   Median : 5.000   Median : 97199  
##                     Mean   :38.92   Mean   : 5.013   Mean   : 76486  
##                     3rd Qu.:44.00   3rd Qu.: 7.000   3rd Qu.:127644  
##                     Max.   :92.00   Max.   :10.000   Max.   :250898  
##  NumOfProducts    HasCrCard      IsActiveMember   EstimatedSalary 
##  Min.   :1.00   Min.   :0.0000   Min.   :0.0000   Min.   :    12  
##  1st Qu.:1.00   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.: 51002  
##  Median :1.00   Median :1.0000   Median :1.0000   Median :100194  
##  Mean   :1.53   Mean   :0.7055   Mean   :0.5151   Mean   :100090  
##  3rd Qu.:2.00   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:149388  
##  Max.   :4.00   Max.   :1.0000   Max.   :1.0000   Max.   :199992  
##      Exited      
##  Min.   :0.0000  
##  1st Qu.:0.0000  
##  Median :0.0000  
##  Mean   :0.2037  
##  3rd Qu.:0.0000  
##  Max.   :1.0000</code></pre>
<p>We can remove 2 variables rownumber and customerid as they are related to individual</p>
<div id="removing-rownumber-and-customerid" class="section level1">
<h1>Removing rownumber and customerid</h1>
<pre class="r"><code>Bank_Churn_Data &lt;- subset (Bank_Churn_Data, select = - RowNumber)
Bank_Churn_Data &lt;- subset (Bank_Churn_Data, select = - CustomerId)</code></pre>
</div>
<div id="structure-of-data" class="section level1">
<h1>Structure of data</h1>
<pre class="r"><code>str(Bank_Churn_Data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    10000 obs. of  11 variables:
##  $ CreditScore    : int  619 608 502 699 850 645 822 376 501 684 ...
##  $ Geography      : chr  &quot;France&quot; &quot;Spain&quot; &quot;France&quot; &quot;France&quot; ...
##  $ Gender         : chr  &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ Age            : int  42 41 42 39 43 44 50 29 44 27 ...
##  $ Tenure         : int  2 1 8 1 2 8 7 4 4 2 ...
##  $ Balance        : int  0 83808 159661 0 125511 113756 0 115047 142051 134604 ...
##  $ NumOfProducts  : int  1 1 3 2 1 2 2 4 2 1 ...
##  $ HasCrCard      : int  1 0 1 0 1 1 1 1 0 1 ...
##  $ IsActiveMember : int  1 1 0 0 1 0 1 0 1 1 ...
##  $ EstimatedSalary: int  101349 112543 113932 93827 79084 149757 10063 119347 74941 71726 ...
##  $ Exited         : int  1 0 1 0 0 1 0 1 0 0 ...</code></pre>
<p>The exited, hascrcard and isactivemember are categorical value but wrongly taken as integer varaiable</p>
</div>
<div id="chaning-the-variable-from-int-to-character" class="section level1">
<h1>Chaning the variable from int to character</h1>
<pre class="r"><code>Bank_Churn_Data$HasCrCard = factor(Bank_Churn_Data$HasCrCard)
Bank_Churn_Data$IsActiveMember = factor(Bank_Churn_Data$IsActiveMember)
Bank_Churn_Data$Exited  = factor(Bank_Churn_Data$Exited )</code></pre>
</div>
<div id="descriptive-statistics" class="section level1">
<h1>Descriptive statistics</h1>
<pre class="r"><code>descr(Bank_Churn_Data)</code></pre>
<pre><code>## Non-numerical variable(s) ignored: Geography, Gender, HasCrCard, IsActiveMember, Exited</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data  
## N: 10000  
## 
##                          Age     Balance   CreditScore   EstimatedSalary   NumOfProducts     Tenure
## ----------------- ---------- ----------- ------------- ----------------- --------------- ----------
##              Mean      38.92    76485.90        650.53         100090.24            1.53       5.01
##           Std.Dev      10.49    62397.41         96.65          57510.49            0.58       2.89
##               Min      18.00        0.00        350.00             12.00            1.00       0.00
##                Q1      32.00        0.00        584.00          50993.00            1.00       3.00
##            Median      37.00    97198.50        652.00         100193.50            1.00       5.00
##                Q3      44.00   127646.00        718.00         149392.00            2.00       7.00
##               Max      92.00   250898.00        850.00         199992.00            4.00      10.00
##               MAD       8.90    69336.01         99.33          72941.70            0.00       2.97
##               IQR      12.00   127644.00        134.00          98386.00            1.00       4.00
##                CV       0.27        0.82          0.15              0.57            0.38       0.58
##          Skewness       1.01       -0.14         -0.07              0.00            0.75       0.01
##       SE.Skewness       0.02        0.02          0.02              0.02            0.02       0.02
##          Kurtosis       1.39       -1.49         -0.43             -1.18            0.58      -1.17
##           N.Valid   10000.00    10000.00      10000.00          10000.00        10000.00   10000.00
##         Pct.Valid     100.00      100.00        100.00            100.00          100.00     100.00</code></pre>
</div>
<div id="revised-structure" class="section level1">
<h1>Revised structure</h1>
<pre class="r"><code>str(Bank_Churn_Data)</code></pre>
<pre><code>## &#39;data.frame&#39;:    10000 obs. of  11 variables:
##  $ CreditScore    : int  619 608 502 699 850 645 822 376 501 684 ...
##  $ Geography      : chr  &quot;France&quot; &quot;Spain&quot; &quot;France&quot; &quot;France&quot; ...
##  $ Gender         : chr  &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ Age            : int  42 41 42 39 43 44 50 29 44 27 ...
##  $ Tenure         : int  2 1 8 1 2 8 7 4 4 2 ...
##  $ Balance        : int  0 83808 159661 0 125511 113756 0 115047 142051 134604 ...
##  $ NumOfProducts  : int  1 1 3 2 1 2 2 4 2 1 ...
##  $ HasCrCard      : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 1 2 1 2 2 2 2 1 2 ...
##  $ IsActiveMember : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 2 1 1 2 1 2 1 2 2 ...
##  $ EstimatedSalary: int  101349 112543 113932 93827 79084 149757 10063 119347 74941 71726 ...
##  $ Exited         : Factor w/ 2 levels &quot;0&quot;,&quot;1&quot;: 2 1 2 1 1 2 1 2 1 1 ...</code></pre>
</div>
<div id="univariate-analysis-on-numerical-data" class="section level1">
<h1>Univariate analysis on numerical data</h1>
</div>
<div id="univariate-analysis-on-age" class="section level1">
<h1>Univariate analysis on Age</h1>
<pre class="r"><code>descr(Bank_Churn_Data$Age)</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data$Age  
## N: 10000  
## 
##                          Age
## ----------------- ----------
##              Mean      38.92
##           Std.Dev      10.49
##               Min      18.00
##                Q1      32.00
##            Median      37.00
##                Q3      44.00
##               Max      92.00
##               MAD       8.90
##               IQR      12.00
##                CV       0.27
##          Skewness       1.01
##       SE.Skewness       0.02
##          Kurtosis       1.39
##           N.Valid   10000.00
##         Pct.Valid     100.00</code></pre>
</div>
<div id="boxplot-of-age-and-its-outliers" class="section level1">
<h1>Boxplot of age and its outliers</h1>
<pre class="r"><code>Age_outliers_churn&lt;-boxplot.stats(Bank_Churn_Data$Age)$out
boxplot(Bank_Churn_Data$Age, main = &quot;Box plot of age&quot;, boxwex = 0.6)
mtext(paste(&quot;Outliers: &quot;, paste(Age_outliers_churn, collapse =&quot;, &quot;)), cex = 0.6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>Age_outliers_churn</code></pre>
<pre><code>##   [1] 66 75 65 73 65 72 67 67 79 80 68 75 66 66 70 63 72 64 64 70 67 82 63 69 65
##  [26] 69 64 65 74 67 66 67 63 70 71 72 67 74 76 66 63 66 68 67 63 71 66 69 73 65
##  [51] 66 64 69 64 77 74 65 70 67 69 67 74 69 74 74 64 63 63 70 74 65 72 77 66 65
##  [76] 74 88 63 71 63 64 67 70 68 72 71 66 75 67 73 69 76 63 85 67 74 76 66 69 66
## [101] 72 63 71 63 74 67 72 72 66 84 71 66 63 74 69 84 67 64 68 66 77 70 67 79 67
## [126] 76 73 66 67 64 73 76 72 64 71 63 70 65 66 65 80 66 63 63 63 63 66 74 69 63
## [151] 64 76 75 68 69 77 64 66 74 71 67 68 64 68 70 64 75 66 64 78 65 74 64 64 71
## [176] 77 79 70 81 64 68 68 63 79 66 64 70 69 71 72 66 68 63 71 72 72 64 78 75 65
## [201] 65 67 63 68 71 73 64 66 71 69 71 66 76 69 73 64 64 75 73 71 72 63 67 68 73
## [226] 67 64 63 92 65 75 67 71 64 66 64 66 67 77 92 67 63 66 66 68 65 72 71 76 63
## [251] 67 67 66 67 63 65 70 72 77 74 72 73 77 67 71 64 72 81 76 69 68 74 64 64 71
## [276] 68 63 67 63 64 76 63 63 68 67 72 70 81 67 73 66 68 71 66 63 75 69 64 69 70
## [301] 71 71 66 70 63 64 65 63 67 71 67 65 66 63 73 66 64 72 71 69 67 64 81 73 63
## [326] 67 74 83 69 71 78 63 70 69 72 70 63 74 80 69 72 67 76 71 67 71 78 63 63 68
## [351] 64 70 78 69 68 64 64 77 77</code></pre>
<p>The above box plot shows that the age above 63 are outliers. so, we remove those values from the dataset</p>
</div>
<div id="removal-of-outliers-of-age" class="section level1">
<h1>Removal of outliers of age</h1>
<pre class="r"><code>Bank_Churn_Data &lt;- subset (Bank_Churn_Data, Age &lt; 63)</code></pre>
</div>
<div id="univariate-analysis-on-balance" class="section level1">
<h1>Univariate analysis on Balance</h1>
<pre class="r"><code>descr(Bank_Churn_Data$Balance)</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data$Balance  
## N: 9641  
## 
##                       Balance
## ----------------- -----------
##              Mean    76560.68
##           Std.Dev    62401.70
##               Min        0.00
##                Q1        0.00
##            Median    97318.00
##                Q3   127660.00
##               Max   250898.00
##               MAD    69044.68
##               IQR   127660.00
##                CV        0.82
##          Skewness       -0.14
##       SE.Skewness        0.02
##          Kurtosis       -1.49
##           N.Valid     9641.00
##         Pct.Valid      100.00</code></pre>
</div>
<div id="boxplot-of-balance-and-its-outliers" class="section level1">
<h1>Boxplot of Balance and its outliers</h1>
<pre class="r"><code>Balance_outliers_churn&lt;-boxplot.stats(Bank_Churn_Data$Balance)$out
boxplot(Bank_Churn_Data$Balance, main = &quot;Box plot of Balance&quot;, boxwex = 0.6)
mtext(paste(&quot;Outliers: &quot;, paste(Balance_outliers_churn, collapse =&quot;, &quot;)), cex = 0.6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>Balance_outliers_churn</code></pre>
<pre><code>## integer(0)</code></pre>
<p>There are no outliers</p>
</div>
<div id="univariate-analysis-on-creditscore" class="section level1">
<h1>Univariate analysis on CreditScore</h1>
<pre class="r"><code>descr(Bank_Churn_Data$CreditScore)</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data$CreditScore  
## N: 9641  
## 
##                     CreditScore
## ----------------- -------------
##              Mean        650.29
##           Std.Dev         96.69
##               Min        350.00
##                Q1        583.00
##            Median        652.00
##                Q3        717.00
##               Max        850.00
##               MAD         99.33
##               IQR        134.00
##                CV          0.15
##          Skewness         -0.07
##       SE.Skewness          0.02
##          Kurtosis         -0.43
##           N.Valid       9641.00
##         Pct.Valid        100.00</code></pre>
</div>
<div id="boxplot-of-creditscore-and-its-outliers" class="section level1">
<h1>Boxplot of CreditScore and its outliers</h1>
<pre class="r"><code>CreditScore_outliers_churn&lt;-boxplot.stats(Bank_Churn_Data$CreditScore)$out
boxplot(Bank_Churn_Data$CreditScore, main = &quot;Box plot of CreditScore&quot;, boxwex = 0.6)
mtext(paste(&quot;Outliers: &quot;, paste(CreditScore_outliers_churn, collapse =&quot;, &quot;)), cex = 0.6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>CreditScore_outliers_churn</code></pre>
<pre><code>##  [1] 376 376 363 359 350 350 358 351 365 367 350 350 373 350</code></pre>
<p>We can see that less than 376 credit score are outliers. So, we remove those values from the dataset.</p>
</div>
<div id="removal-of-outliers-of-creditscore" class="section level1">
<h1>Removal of outliers of CreditScore</h1>
<pre class="r"><code>Bank_Churn_Data &lt;- subset (Bank_Churn_Data, CreditScore &gt; 376)</code></pre>
</div>
<div id="univariate-analysis-on-estimatedsalary" class="section level1">
<h1>Univariate analysis on EstimatedSalary</h1>
<pre class="r"><code>descr(Bank_Churn_Data$EstimatedSalary)</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data$EstimatedSalary  
## N: 9627  
## 
##                     EstimatedSalary
## ----------------- -----------------
##              Mean         100121.62
##           Std.Dev          57524.28
##               Min             12.00
##                Q1          51011.00
##            Median         100187.00
##                Q3         149458.00
##               Max         199992.00
##               MAD          72964.68
##               IQR          98424.50
##                CV              0.57
##          Skewness              0.00
##       SE.Skewness              0.02
##          Kurtosis             -1.18
##           N.Valid           9627.00
##         Pct.Valid            100.00</code></pre>
</div>
<div id="boxplot-of-estimatedsalary-and-its-outliers" class="section level1">
<h1>Boxplot of EstimatedSalary and its outliers</h1>
<pre class="r"><code>EstimatedSalary_outliers_churn&lt;-boxplot.stats(Bank_Churn_Data$EstimatedSalary)$out
boxplot(Bank_Churn_Data$EstimatedSalary, main = &quot;Box plot of EstimatedSalary&quot;, boxwex = 0.6)
mtext(paste(&quot;Outliers: &quot;, paste(EstimatedSalary_outliers_churn, collapse =&quot;, &quot;)), cex = 0.6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>EstimatedSalary_outliers_churn</code></pre>
<pre><code>## integer(0)</code></pre>
<p>There are no outliers</p>
</div>
<div id="univariate-analysis-on-numofproducts" class="section level1">
<h1>Univariate analysis on NumOfProducts</h1>
<pre class="r"><code>descr(Bank_Churn_Data$NumOfProducts)</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data$NumOfProducts  
## N: 9627  
## 
##                     NumOfProducts
## ----------------- ---------------
##              Mean            1.53
##           Std.Dev            0.58
##               Min            1.00
##                Q1            1.00
##            Median            1.00
##                Q3            2.00
##               Max            4.00
##               MAD            0.00
##               IQR            1.00
##                CV            0.38
##          Skewness            0.74
##       SE.Skewness            0.02
##          Kurtosis            0.58
##           N.Valid         9627.00
##         Pct.Valid          100.00</code></pre>
</div>
<div id="boxplot-of-numofproducts-and-its-outliers" class="section level1">
<h1>Boxplot of NumOfProducts and its outliers</h1>
<pre class="r"><code>NumOfProducts_outliers_churn&lt;-boxplot.stats(Bank_Churn_Data$NumOfProducts)$out
boxplot(Bank_Churn_Data$NumOfProducts, main = &quot;Box plot of NumOfProducts&quot;, boxwex = 0.6)
mtext(paste(&quot;Outliers: &quot;, paste(NumOfProducts_outliers_churn, collapse =&quot;, &quot;)), cex = 0.6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>NumOfProducts_outliers_churn</code></pre>
<pre><code>##  [1] 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4
## [39] 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4 4</code></pre>
<p>We can see that there are few people having 4 products and it is an outliers here. SO, we remove it from the dataset</p>
</div>
<div id="removal-of-outliers-of-numofproducts" class="section level1">
<h1>Removal of outliers of NumOfProducts</h1>
<pre class="r"><code>Bank_Churn_Data &lt;- subset (Bank_Churn_Data, NumOfProducts &lt; 4)</code></pre>
</div>
<div id="univariate-analysis-on-tenure" class="section level1">
<h1>Univariate analysis on Tenure</h1>
<pre class="r"><code>descr(Bank_Churn_Data$Tenure)</code></pre>
<pre><code>## Descriptive Statistics  
## Bank_Churn_Data$Tenure  
## N: 9569  
## 
##                      Tenure
## ----------------- ---------
##              Mean      5.01
##           Std.Dev      2.89
##               Min      0.00
##                Q1      3.00
##            Median      5.00
##                Q3      7.00
##               Max     10.00
##               MAD      2.97
##               IQR      4.00
##                CV      0.58
##          Skewness      0.01
##       SE.Skewness      0.03
##          Kurtosis     -1.16
##           N.Valid   9569.00
##         Pct.Valid    100.00</code></pre>
</div>
<div id="boxplot-of-tenure-and-its-outliers" class="section level1">
<h1>Boxplot of Tenure and its outliers</h1>
<pre class="r"><code>Tenure_outliers_churn&lt;-boxplot.stats(Bank_Churn_Data$Tenure)$out
boxplot(Bank_Churn_Data$Tenure, main = &quot;Box plot of Tenure&quot;, boxwex = 0.6)
mtext(paste(&quot;Outliers: &quot;, paste(Tenure_outliers_churn, collapse =&quot;, &quot;)), cex = 0.6)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code>Tenure_outliers_churn</code></pre>
<pre><code>## integer(0)</code></pre>
<p>There are no outliers for tenure</p>
</div>
<div id="univariate-analysis-on-categorical-values" class="section level1">
<h1>Univariate analysis on categorical values</h1>
<p>I analyzed the categorical values using frequency distribution to figure out least distribution among the distributed values.</p>
</div>
<div id="frequency-distribution-of-geography" class="section level1">
<h1>Frequency distribution of Geography</h1>
<pre class="r"><code>tab1(Bank_Churn_Data$Geography, sort.group = &quot;increasing&quot;, cum.percent = TRUE, main = &quot;Frequency distribution of Geography&quot;, xlab =&quot;Geography&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<pre><code>## Bank_Churn_Data$Geography : 
##         Frequency Percent Cum. percent
## Spain        2373    24.8         24.8
## Germany      2398    25.1         49.9
## France       4798    50.1        100.0
##   Total      9569   100.0        100.0</code></pre>
</div>
<div id="frequency-distribution-of-gender" class="section level1">
<h1>Frequency distribution of Gender</h1>
<pre class="r"><code>tab1(Bank_Churn_Data$Gender, sort.group = &quot;increasing&quot;, cum.percent = TRUE, main = &quot;Frequency distribution of Gender&quot;, xlab =&quot;Gender&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre><code>## Bank_Churn_Data$Gender : 
##         Frequency Percent Cum. percent
## Female       4332    45.3         45.3
## Male         5237    54.7        100.0
##   Total      9569   100.0        100.0</code></pre>
<p>There are more people having account with bank compared to female members</p>
</div>
<div id="frequency-distribution-of-hascrcard" class="section level1">
<h1>Frequency distribution of HasCrCard</h1>
<pre class="r"><code>tab1(Bank_Churn_Data$HasCrCard, sort.group = &quot;increasing&quot;, cum.percent = TRUE, main = &quot;Frequency distribution of HasCrCard&quot;, xlab =&quot;HasCrCard&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<pre><code>## Bank_Churn_Data$HasCrCard : 
##         Frequency Percent Cum. percent
## 0            2821    29.5         29.5
## 1            6748    70.5        100.0
##   Total      9569   100.0        100.0</code></pre>
<p>Around 70% of customers have a credit card with bank and only 30% of people without credit card</p>
</div>
<div id="frequency-distribution-of-isactivemember" class="section level1">
<h1>Frequency distribution of IsActiveMember</h1>
<pre class="r"><code>tab1(Bank_Churn_Data$IsActiveMember, sort.group = &quot;increasing&quot;, cum.percent = TRUE, main = &quot;Frequency distribution of IsActiveMember&quot;, xlab =&quot;IsActiveMember&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<pre><code>## Bank_Churn_Data$IsActiveMember : 
##         Frequency Percent Cum. percent
## 0            4749    49.6         49.6
## 1            4820    50.4        100.0
##   Total      9569   100.0        100.0</code></pre>
<p>Almost 50% of customer are not actively making transaction in bank.</p>
</div>
<div id="frequency-distribution-of-exited" class="section level1">
<h1>Frequency distribution of Exited</h1>
<pre class="r"><code>tab1(Bank_Churn_Data$Exited , sort.group = &quot;increasing&quot;, cum.percent = TRUE, main = &quot;Frequency distribution of Exited &quot;, xlab =&quot;Exited &quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<pre><code>## Bank_Churn_Data$Exited : 
##         Frequency Percent Cum. percent
## 1            1892    19.8         19.8
## 0            7677    80.2        100.0
##   Total      9569   100.0        100.0</code></pre>
<p>We could see from the above frequency distribution that only 20% of customers was a loyal customer and approximately 80% of customers closed the bank account</p>
</div>
<div id="bivariate-analysis-to-see-the-relationship-between-dependant-and-independant-variable" class="section level1">
<h1>Bivariate analysis to see the relationship between dependant and independant variable</h1>
<p>Here, we will analyze the relationship between response and explanatory variables.</p>
</div>
<div id="relationship-between-exited-and-age" class="section level1">
<h1>Relationship between Exited and Age</h1>
<pre class="r"><code>Age_Exited = glm(Exited~ Age, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(Age_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Age, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.5677  -0.6369  -0.4780  -0.3213   2.7153  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -5.519707   0.137290  -40.20   &lt;2e-16 ***
## Age          0.103265   0.003233   31.94   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 8334.7  on 9567  degrees of freedom
## AIC: 8338.7
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>There is a significant relationship between age and exited</p>
<pre class="r"><code>discretized.Age = cut(Bank_Churn_Data$Age, c(0, 10, 20, 30, 40, 50, 60,70))
ggplot(Bank_Churn_Data, aes(x = discretized.Age , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="relationship-between-exited-and-balance" class="section level1">
<h1>Relationship between Exited and Balance</h1>
<pre class="r"><code>Balance_Exited = glm(Exited~ Balance, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(Balance_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Balance, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.8838  -0.7175  -0.5558  -0.5558   1.9718  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.790e+00  4.535e-02  -39.46   &lt;2e-16 ***
## Balance      4.745e-06  4.260e-07   11.14   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9387.9  on 9567  degrees of freedom
## AIC: 9391.9
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>There is a significant relationship between balance and exited</p>
<pre class="r"><code>discretized.Balance = cut(Bank_Churn_Data$Balance, c(0, 50000, 100000, 150000, 200000, 250000, 300000))
ggplot(Bank_Churn_Data, aes(x = discretized.Balance , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-32-1.png" width="672" />
######################################Have to check the above error</p>
</div>
<div id="relationship-between-exited-and-creditscore" class="section level1">
<h1>Relationship between Exited and CreditScore</h1>
<pre class="r"><code>CreditScore_Exited = glm(Exited~ CreditScore, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(Balance_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Balance, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.8838  -0.7175  -0.5558  -0.5558   1.9718  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.790e+00  4.535e-02  -39.46   &lt;2e-16 ***
## Balance      4.745e-06  4.260e-07   11.14   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9387.9  on 9567  degrees of freedom
## AIC: 9391.9
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The credit score is significant to predict the exited</p>
<pre class="r"><code>discretized.CreditScore = cut(Bank_Churn_Data$CreditScore, c(0,400, 500, 600, 700, 800, 900))
ggplot(Bank_Churn_Data, aes(x = discretized.CreditScore , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-34-1.png" width="672" />
We can infer from the above bar chart that more people are churned when the credit score is between 600 and 700.</p>
</div>
<div id="relationship-between-exited-and-estimatedsalary" class="section level1">
<h1>Relationship between Exited and EstimatedSalary</h1>
<pre class="r"><code>EstimatedSalary_Exited = glm(Exited~ EstimatedSalary, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(EstimatedSalary_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ EstimatedSalary, family = &quot;binomial&quot;, 
##     data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.6753  -0.6680  -0.6610  -0.6537   1.8178  
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     -1.440e+00  5.182e-02 -27.779   &lt;2e-16 ***
## EstimatedSalary  3.875e-07  4.463e-07   0.868    0.385    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9515.2  on 9567  degrees of freedom
## AIC: 9519.2
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The coefficient of the estimated salary are not significant to predict the exited</p>
<pre class="r"><code>discretized.EstimatedSalary = cut(Bank_Churn_Data$EstimatedSalary, c(0,40000, 80000, 120000, 160000, 200000))
ggplot(Bank_Churn_Data, aes(x = discretized.EstimatedSalary , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-36-1.png" width="672" />
################################################### have to check the error</p>
</div>
<div id="relationship-between-exited-and-numofproducts" class="section level1">
<h1>Relationship between Exited and NumOfProducts</h1>
<pre class="r"><code>NumOfProducts_Exited = glm(Exited~ NumOfProducts, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(NumOfProducts_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ NumOfProducts, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.7401  -0.7401  -0.5848  -0.5848   2.1487  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -0.63043    0.07476  -8.433   &lt;2e-16 ***
## NumOfProducts -0.52446    0.04935 -10.628   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9398.0  on 9567  degrees of freedom
## AIC: 9402
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The number of bank products held by customers has a significant relationship to predict the customers exited</p>
<pre class="r"><code>ggplot(Bank_Churn_Data, aes(x = NumOfProducts , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-38-1.png" width="672" />
The percentage of the churn rate for customer having 1 and 2 account having more churn rate comparedd to customer having 3 products</p>
</div>
<div id="relationship-between-exited-and-tenure" class="section level1">
<h1>Relationship between Exited and Tenure</h1>
<pre class="r"><code>Tenure_Exited = glm(Exited~ Tenure, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(Tenure_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Tenure, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.6826  -0.6712  -0.6600  -0.6489   1.8285  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.337962   0.050962 -26.254   &lt;2e-16 ***
## Tenure      -0.012569   0.008891  -1.414    0.157    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9513.9  on 9567  degrees of freedom
## AIC: 9517.9
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The coefficient of the tenure is not significant to predict the exited</p>
<pre class="r"><code>ggplot(Bank_Churn_Data, aes(x = Tenure , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-40-1.png" width="672" />
It is surprising to see that 828 customer after having 7 years of relationship with bank, that was the highest churn numbers among different tenures.</p>
</div>
<div id="relationship-between-exited-and-geography" class="section level1">
<h1>Relationship between Exited and Geography</h1>
<pre class="r"><code>Geography_Exited = glm(Exited~ Geography, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(Geography_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Geography, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.8717  -0.5950  -0.5826  -0.5826   1.9273  
## 
## Coefficients:
##                  Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      -1.68749    0.03978  -42.42   &lt;2e-16 ***
## GeographyGermany  0.91572    0.05925   15.45   &lt;2e-16 ***
## GeographySpain    0.04585    0.06843    0.67    0.503    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9253.0  on 9566  degrees of freedom
## AIC: 9259
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>There is no significant relationship between geography and exited due to some of the coefficients are not significant</p>
<pre class="r"><code>ggplot(Bank_Churn_Data, aes(x = Geography , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-42-1.png" width="672" />
France has the highest churn rate of customers among others. Almost 85% of the customer closed the account.</p>
</div>
<div id="relationship-between-exited-and-gender" class="section level1">
<h1>Relationship between Exited and Gender</h1>
<pre class="r"><code>Gender_Exited = glm(Exited~ Gender, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(Gender_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Gender, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.7467  -0.7467  -0.5905  -0.5905   1.9144  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.13464    0.03541  -32.04   &lt;2e-16 ***
## GenderMale  -0.52347    0.05172  -10.12   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9412.7  on 9567  degrees of freedom
## AIC: 9416.7
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>There is a significant relationship between gender and exited</p>
<pre class="r"><code>ggplot(Bank_Churn_Data, aes(x = Gender , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p>There is a highest churn rate with male customer with approximate churn percentage of 84% as against female churn rate of 75% approximately.</p>
</div>
<div id="relationship-between-exited-and-hascrcard" class="section level1">
<h1>Relationship between Exited and HasCrCard</h1>
<pre class="r"><code>HasCrCard_Exited = glm(Exited~ HasCrCard, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(HasCrCard_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ HasCrCard, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.6725  -0.6601  -0.6601  -0.6601   1.8060  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.37130    0.04686 -29.264   &lt;2e-16 ***
## HasCrCard1  -0.04170    0.05601  -0.745    0.457    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9515.4  on 9567  degrees of freedom
## AIC: 9519.4
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>There is no significant relationship between the customer having credit card and exited because of its coefficients are not significant.</p>
<pre class="r"><code>ggplot(Bank_Churn_Data, aes(x = HasCrCard , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-46-1.png" width="672" />
Almost 80% of customers closed the account irrespective of customers having credit card or not.</p>
</div>
<div id="relationship-between-exited-and-isactivemember" class="section level1">
<h1>Relationship between Exited and IsActiveMember</h1>
<pre class="r"><code>IsActiveMember_Exited = glm(Exited~ IsActiveMember, data = Bank_Churn_Data, family = &quot;binomial&quot;)
summary(IsActiveMember_Exited)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ IsActiveMember, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.7688  -0.7688  -0.5502  -0.5502   1.9813  
## 
## Coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     -1.06769    0.03326   -32.1   &lt;2e-16 ***
## IsActiveMember1 -0.74382    0.05315   -14.0   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 9313.0  on 9567  degrees of freedom
## AIC: 9317
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>There is a significant relationship between IsActiveMember and Exited.</p>
<pre class="r"><code>ggplot(Bank_Churn_Data, aes(x = IsActiveMember , fill = Exited )) + geom_bar(position = position_dodge())+geom_text(stat = &#39;count&#39;, aes(label = stat(count)), position = position_dodge(width =1), vjust = -0.4)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>It is surprising to notice that actively transacted customers(86%) have high percentage of churn rate against customers who have not transacted actively (75%)</p>
</div>
<div id="full-model-logistic-regression" class="section level1">
<h1>Full model logistic regression</h1>
<pre class="r"><code>full_model_bank_churn = glm(Exited ~ ., family = &quot;binomial&quot;, data = Bank_Churn_Data)
summary(full_model_bank_churn)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ ., family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2085  -0.6213  -0.4107  -0.2280   3.2385  
## 
## Coefficients:
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      -4.574e+00  2.789e-01 -16.399  &lt; 2e-16 ***
## CreditScore      -3.375e-04  3.002e-04  -1.124  0.26101    
## GeographyGermany  8.210e-01  7.215e-02  11.380  &lt; 2e-16 ***
## GeographySpain    3.217e-02  7.474e-02   0.430  0.66685    
## GenderMale       -5.318e-01  5.785e-02  -9.193  &lt; 2e-16 ***
## Age               1.089e-01  3.454e-03  31.541  &lt; 2e-16 ***
## Tenure           -1.611e-02  9.943e-03  -1.620  0.10520    
## Balance           1.519e-06  5.512e-07   2.756  0.00586 ** 
## NumOfProducts    -4.038e-01  5.478e-02  -7.371 1.69e-13 ***
## HasCrCard1       -2.773e-02  6.295e-02  -0.441  0.65954    
## IsActiveMember1  -9.428e-01  6.006e-02 -15.696  &lt; 2e-16 ***
## EstimatedSalary   4.489e-07  5.029e-07   0.893  0.37210    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 7667.3  on 9557  degrees of freedom
## AIC: 7691.3
## 
## Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div id="backward-regression" class="section level1">
<h1>Backward Regression</h1>
<pre class="r"><code>mod_step_bank_churn&lt;- stepAIC(full_model_bank_churn, direction = &#39;backward&#39;, trace = FALSE)
mod_step_bank_churn</code></pre>
<pre><code>## 
## Call:  glm(formula = Exited ~ Geography + Gender + Age + Tenure + Balance + 
##     NumOfProducts + IsActiveMember, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Coefficients:
##      (Intercept)  GeographyGermany    GeographySpain        GenderMale  
##       -4.771e+00         8.201e-01         3.131e-02        -5.317e-01  
##              Age            Tenure           Balance     NumOfProducts  
##        1.090e-01        -1.599e-02         1.531e-06        -4.029e-01  
##  IsActiveMember1  
##       -9.445e-01  
## 
## Degrees of Freedom: 9568 Total (i.e. Null);  9560 Residual
## Null Deviance:       9516 
## Residual Deviance: 7670  AIC: 7688</code></pre>
</div>
<div id="bootstrap-method" class="section level1">
<h1>Bootstrap method</h1>
<p>Using bootstrap re sampling with replacement method to access the consistency predictors selected with stepwise</p>
<pre class="r"><code>mod_boot_bank_churn&lt;- boot.stepAIC(full_model_bank_churn, Bank_Churn_Data, B =50)</code></pre>
<div id="bootstrap-summary" class="section level2">
<h2>Bootstrap summary</h2>
<pre class="r"><code>print(mod_boot_bank_churn)</code></pre>
<pre><code>## 
## Summary of Bootstrapping the &#39;stepAIC()&#39; procedure for
## 
## Call:
## glm(formula = Exited ~ ., family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Bootstrap samples: 50 
## Direction: backward 
## Penalty: 2 * df
## 
## Covariates selected
##                 (%)
## Age             100
## Gender          100
## Geography       100
## IsActiveMember  100
## NumOfProducts   100
## Balance          88
## Tenure           60
## CreditScore      44
## EstimatedSalary  38
## HasCrCard        14
## 
## Coefficients Sign
##                   + (%)  - (%)
## Age              100.00   0.00
## Balance          100.00   0.00
## EstimatedSalary  100.00   0.00
## GeographyGermany 100.00   0.00
## GeographySpain    70.00  30.00
## HasCrCard1        42.86  57.14
## CreditScore        0.00 100.00
## GenderMale         0.00 100.00
## IsActiveMember1    0.00 100.00
## NumOfProducts      0.00 100.00
## Tenure             0.00 100.00
## 
## Stat Significance
##                     (%)
## Age              100.00
## GenderMale       100.00
## GeographyGermany 100.00
## IsActiveMember1  100.00
## NumOfProducts    100.00
## Balance           86.36
## Tenure            63.33
## CreditScore       45.45
## HasCrCard1        42.86
## EstimatedSalary   42.11
## GeographySpain    10.00
## 
## 
## The stepAIC() for the original data-set gave
## 
## Call:  glm(formula = Exited ~ Geography + Gender + Age + Tenure + Balance + 
##     NumOfProducts + IsActiveMember, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Coefficients:
##      (Intercept)  GeographyGermany    GeographySpain        GenderMale  
##       -4.771e+00         8.201e-01         3.131e-02        -5.317e-01  
##              Age            Tenure           Balance     NumOfProducts  
##        1.090e-01        -1.599e-02         1.531e-06        -4.029e-01  
##  IsActiveMember1  
##       -9.445e-01  
## 
## Degrees of Freedom: 9568 Total (i.e. Null);  9560 Residual
## Null Deviance:       9516 
## Residual Deviance: 7670  AIC: 7688
## 
## Stepwise Model Path 
## Analysis of Deviance Table
## 
## Initial Model:
## Exited ~ CreditScore + Geography + Gender + Age + Tenure + Balance + 
##     NumOfProducts + HasCrCard + IsActiveMember + EstimatedSalary
## 
## Final Model:
## Exited ~ Geography + Gender + Age + Tenure + Balance + NumOfProducts + 
##     IsActiveMember
## 
## 
##                Step Df  Deviance Resid. Df Resid. Dev      AIC
## 1                                     9557   7667.318 7691.318
## 2       - HasCrCard  1 0.1937752      9558   7667.511 7689.511
## 3 - EstimatedSalary  1 0.7998999      9559   7668.311 7688.311
## 4     - CreditScore  1 1.2713603      9560   7669.583 7687.583</code></pre>
</div>
</div>
<div id="best-model-by-backward-and-bootstrap-method" class="section level1">
<h1>Best model by backward and bootstrap method</h1>
<pre class="r"><code>best_bootmodel_bank_churn&lt;- glm(formula = Exited ~ Geography + Gender + Age + Tenure + Balance + NumOfProducts + 
    IsActiveMember, family = &quot;binomial&quot;, 
    data = Bank_Churn_Data)
summary(best_bootmodel_bank_churn) </code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Geography + Gender + Age + Tenure + Balance + 
##     NumOfProducts + IsActiveMember, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1967  -0.6226  -0.4118  -0.2283   3.2277  
## 
## Coefficients:
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      -4.771e+00  1.855e-01 -25.716  &lt; 2e-16 ***
## GeographyGermany  8.201e-01  7.211e-02  11.373  &lt; 2e-16 ***
## GeographySpain    3.131e-02  7.472e-02   0.419  0.67521    
## GenderMale       -5.317e-01  5.783e-02  -9.193  &lt; 2e-16 ***
## Age               1.090e-01  3.453e-03  31.562  &lt; 2e-16 ***
## Tenure           -1.599e-02  9.938e-03  -1.609  0.10758    
## Balance           1.531e-06  5.510e-07   2.778  0.00547 ** 
## NumOfProducts    -4.029e-01  5.476e-02  -7.357 1.88e-13 ***
## IsActiveMember1  -9.445e-01  6.003e-02 -15.734  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 7669.6  on 9560  degrees of freedom
## AIC: 7687.6
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>We could see in the above selected bootstrap and stepwise regression model that some of the coefficients such as geography and tenure are not significant. SO to get better significant model, geography and tenure are to be removed.</p>
</div>
<div id="best-model-after-many-iterations" class="section level1">
<h1>Best model after many iterations</h1>
<pre class="r"><code>bestmodel&lt;- glm(formula = Exited ~  Gender + Age + Balance + NumOfProducts + 
    IsActiveMember, family = &quot;binomial&quot;, 
    data = Bank_Churn_Data)
summary(bestmodel)</code></pre>
<pre><code>## 
## Call:
## glm(formula = Exited ~ Gender + Age + Balance + NumOfProducts + 
##     IsActiveMember, family = &quot;binomial&quot;, data = Bank_Churn_Data)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0542  -0.6342  -0.4224  -0.2347   3.1988  
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     -4.936e+00  1.766e-01 -27.944  &lt; 2e-16 ***
## GenderMale      -5.534e-01  5.721e-02  -9.673  &lt; 2e-16 ***
## Age              1.094e-01  3.417e-03  32.022  &lt; 2e-16 ***
## Balance          4.112e-06  4.921e-07   8.357  &lt; 2e-16 ***
## NumOfProducts   -3.231e-01  5.395e-02  -5.989 2.11e-09 ***
## IsActiveMember1 -9.446e-01  5.942e-02 -15.898  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 9515.9  on 9568  degrees of freedom
## Residual deviance: 7815.6  on 9563  degrees of freedom
## AIC: 7827.6
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>The above is the best model after many iterations as all the coefficients are 99.9% significant to predict the response variable exited.</p>
</div>
<div id="data-resampling" class="section level1">
<h1>Data resampling</h1>
<pre class="r"><code>bank_churn_split &lt;- initial_split (Bank_Churn_Data, prop = 0.80, strata = Exited)
bank_churn_training &lt;- bank_churn_split %&gt;%
  training()
bank_churn_test &lt;- bank_churn_split %&gt;%
  testing()</code></pre>
<p>We have taken 80:20 split for data sampling. We have made training data to fit the model and test the model using test set.</p>
</div>
<div id="checking-number-of-rows-in-training-and-test-data" class="section level1">
<h1>Checking number of rows in training and test data</h1>
<pre class="r"><code>nrow(bank_churn_training)</code></pre>
<pre><code>## [1] 7654</code></pre>
<pre class="r"><code>nrow(bank_churn_test)</code></pre>
<pre><code>## [1] 1915</code></pre>
<p>There are total 7654 numbers of row in training data and 1915 numbers of row in test data.</p>
</div>
<div id="checking-multicollinearity-between-numerical-values-in-a-training-bank-churn-data-set" class="section level1">
<h1>Checking multicollinearity between numerical values in a training bank churn data set</h1>
<pre class="r"><code>bank_churn_training %&gt;%
  select_if(is.numeric) %&gt;%
  cor()</code></pre>
<pre><code>##                   CreditScore           Age        Tenure       Balance
## CreditScore      1.0000000000 -0.0005626469  0.0002274911  0.0007726393
## Age             -0.0005626469  1.0000000000 -0.0123786627  0.0468639241
## Tenure           0.0002274911 -0.0123786627  1.0000000000 -0.0161014336
## Balance          0.0007726393  0.0468639241 -0.0161014336  1.0000000000
## NumOfProducts    0.0075203453 -0.0528727927  0.0168500890 -0.3315702852
## EstimatedSalary -0.0015708436 -0.0093230263  0.0108652084 -0.0035422861
##                 NumOfProducts EstimatedSalary
## CreditScore       0.007520345    -0.001570844
## Age              -0.052872793    -0.009323026
## Tenure            0.016850089     0.010865208
## Balance          -0.331570285    -0.003542286
## NumOfProducts     1.000000000     0.024464746
## EstimatedSalary   0.024464746     1.000000000</code></pre>
<p>There is no multi-colinearity between the independent numeric variables.</p>
</div>
<div id="future-engineering" class="section level1">
<h1>Future engineering</h1>
<p>This is the step to pre-processing of data</p>
<pre class="r"><code>bank_churn_recipe &lt;- recipe(Exited ~ ., data = bank_churn_training) %&gt;%
  step_corr(all_numeric(), threshold =0.8) %&gt;%
  step_normalize(all_numeric()) %&gt;%
  step_dummy(all_nominal(), -all_outcomes())
bank_churn_recipe</code></pre>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         10
## 
## Operations:
## 
## Correlation filter on all_numeric()
## Centering and scaling for all_numeric()
## Dummy variables from all_nominal(), -all_outcomes()</code></pre>
<p>There are 10 predictor variable and 1 outcome variable.</p>
</div>
<div id="recipe-training" class="section level1">
<h1>Recipe training</h1>
<pre class="r"><code>bank_churn_recipe_prep&lt;- bank_churn_recipe %&gt;%
  prep(training = bank_churn_training)
bank_churn_recipe_prep</code></pre>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         10
## 
## Training data contained 7654 data points and no missing data.
## 
## Operations:
## 
## Correlation filter removed no terms [trained]
## Centering and scaling for CreditScore, Age, Tenure, Balance, NumOfProduct... [trained]
## Dummy variables from Geography, Gender, HasCrCard, IsActiveMember [trained]</code></pre>
<p>We have prepared the training data set.</p>
</div>
<div id="preprocess-training-data" class="section level1">
<h1>Preprocess training data</h1>
<pre class="r"><code>bank_churn_training_prep &lt;- bank_churn_recipe_prep %&gt;%
  bake (new_data = NULL)
bank_churn_training_prep</code></pre>
<pre><code>## # A tibble: 7,654 x 12
##    CreditScore    Age    Tenure Balance NumOfProducts EstimatedSalary Exited
##          &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;fct&gt; 
##  1      -0.451  0.379 -1.38       0.112        -0.940           0.214 0     
##  2       0.494  0.151 -1.38      -1.23          0.878          -0.112 0     
##  3       2.06   0.606 -1.04       0.781        -0.940          -0.368 0     
##  4       1.77   1.40   0.692     -1.23          0.878          -1.57  0     
##  5      -1.56   0.720 -0.345      1.05          0.878          -0.440 0     
##  6       0.339 -1.21  -1.04       0.927        -0.940          -0.496 0     
##  7      -1.60  -1.56  -0.691     -1.23          0.878          -0.415 0     
##  8      -1.06  -1.44   0.000542  -1.23          0.878           1.58  0     
##  9      -0.170 -0.304  0.692     -1.23          0.878          -0.596 0     
## 10      -0.368  0.834 -0.691      1.06          0.878          -0.625 0     
## # ... with 7,644 more rows, and 5 more variables: Geography_Germany &lt;dbl&gt;,
## #   Geography_Spain &lt;dbl&gt;, Gender_Male &lt;dbl&gt;, HasCrCard_X1 &lt;dbl&gt;,
## #   IsActiveMember_X1 &lt;dbl&gt;</code></pre>
<p>We have pre-processed the training data set.</p>
</div>
<div id="preprocess-test-data" class="section level1">
<h1>Preprocess test data</h1>
<pre class="r"><code>bank_churn_test_prep &lt;- bank_churn_recipe_prep %&gt;%
  bake (new_data = bank_churn_test)
bank_churn_test_prep</code></pre>
<pre><code>## # A tibble: 1,915 x 12
##    CreditScore    Age Tenure Balance NumOfProducts EstimatedSalary Exited
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;fct&gt; 
##  1      -1.28  -0.759  0.346   0.404         0.878          -0.349 0     
##  2      -1.82  -0.418  1.73   -1.23          0.878          -1.29  0     
##  3       0.775 -1.56   0.346  -1.23          0.878          -0.792 0     
##  4      -0.160 -0.646  1.04   -1.23          0.878           0.666 0     
##  5      -0.773 -1.44  -0.691  -1.23          0.878           0.422 0     
##  6      -1.83   0.834 -1.73    0.921        -0.940          -1.26  1     
##  7      -1.68  -0.759 -0.691   1.10         -0.940           0.240 0     
##  8      -1.86   0.265 -0.345  -1.23         -0.940          -0.523 0     
##  9       1.90   1.29  -1.04    0.875        -0.940           1.64  1     
## 10       1.29  -0.646 -0.345   0.523         0.878           0.457 0     
## # ... with 1,905 more rows, and 5 more variables: Geography_Germany &lt;dbl&gt;,
## #   Geography_Spain &lt;dbl&gt;, Gender_Male &lt;dbl&gt;, HasCrCard_X1 &lt;dbl&gt;,
## #   IsActiveMember_X1 &lt;dbl&gt;</code></pre>
<p>We pre-processed the test data.</p>
</div>
<div id="machine-learning-models-using-random-forest" class="section level1">
<h1>Machine learning models using random forest</h1>
<pre class="r"><code>bank_churn_rf_model&lt;- rand_forest(mtry =4,trees = 100, min_n =10) %&gt;%
  set_engine(&#39;ranger&#39;) %&gt;%
  set_mode(&#39;classification&#39;)</code></pre>
<p>We have used 100 trees to create a model using random forest</p>
</div>
<div id="training-a-forest" class="section level1">
<h1>Training a forest</h1>
<pre class="r"><code>bank_churn_fit_rf &lt;- bank_churn_rf_model %&gt;%
  fit (Exited ~ ., data = bank_churn_training_prep)
bank_churn_fit_rf</code></pre>
<pre><code>## parsnip model object
## 
## Fit time:  860ms 
## Ranger result
## 
## Call:
##  ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~4,      x), num.trees = ~100, min.node.size = min_rows(~10, x), num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1), probability = TRUE) 
## 
## Type:                             Probability estimation 
## Number of trees:                  100 
## Sample size:                      7654 
## Number of independent variables:  11 
## Mtry:                             4 
## Target node size:                 10 
## Variable importance mode:         none 
## Splitrule:                        gini 
## OOB prediction error (Brier s.):  0.1069227</code></pre>
</div>
<div id="predicting-outcome-variables" class="section level1">
<h1>Predicting outcome variables</h1>
<pre class="r"><code>bank_churn_class_preds_rf &lt;- predict(bank_churn_fit_rf, new_data = bank_churn_test_prep, type = &quot;class&quot;)
bank_churn_class_preds_rf</code></pre>
<pre><code>## # A tibble: 1,915 x 1
##    .pred_class
##    &lt;fct&gt;      
##  1 0          
##  2 0          
##  3 0          
##  4 0          
##  5 0          
##  6 0          
##  7 0          
##  8 0          
##  9 1          
## 10 0          
## # ... with 1,905 more rows</code></pre>
<p>The above are predicted outcomes using test set</p>
</div>
<div id="estimated-probabilities" class="section level1">
<h1>Estimated probabilities</h1>
<pre class="r"><code>bank_churn_prob_preds_rf &lt;- predict(bank_churn_fit_rf, new_data = bank_churn_test_prep, type = &quot;prob&quot;)
bank_churn_prob_preds_rf</code></pre>
<pre><code>## # A tibble: 1,915 x 2
##    .pred_0 .pred_1
##      &lt;dbl&gt;   &lt;dbl&gt;
##  1   0.949 0.0512 
##  2   0.956 0.0441 
##  3   0.969 0.0312 
##  4   0.996 0.00374
##  5   0.999 0.00125
##  6   0.588 0.412  
##  7   0.948 0.0518 
##  8   0.673 0.327  
##  9   0.403 0.597  
## 10   0.918 0.0815 
## # ... with 1,905 more rows</code></pre>
<p>The above are the predicted probabilities using test data set.</p>
</div>
<div id="combining-results" class="section level1">
<h1>Combining results</h1>
<pre class="r"><code>bank_churn_results_rf &lt;- bank_churn_test_prep %&gt;%
  bind_cols(bank_churn_class_preds_rf, bank_churn_prob_preds_rf)
bank_churn_results_rf</code></pre>
<pre><code>## # A tibble: 1,915 x 15
##    CreditScore    Age Tenure Balance NumOfProducts EstimatedSalary Exited
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt; &lt;fct&gt; 
##  1      -1.28  -0.759  0.346   0.404         0.878          -0.349 0     
##  2      -1.82  -0.418  1.73   -1.23          0.878          -1.29  0     
##  3       0.775 -1.56   0.346  -1.23          0.878          -0.792 0     
##  4      -0.160 -0.646  1.04   -1.23          0.878           0.666 0     
##  5      -0.773 -1.44  -0.691  -1.23          0.878           0.422 0     
##  6      -1.83   0.834 -1.73    0.921        -0.940          -1.26  1     
##  7      -1.68  -0.759 -0.691   1.10         -0.940           0.240 0     
##  8      -1.86   0.265 -0.345  -1.23         -0.940          -0.523 0     
##  9       1.90   1.29  -1.04    0.875        -0.940           1.64  1     
## 10       1.29  -0.646 -0.345   0.523         0.878           0.457 0     
## # ... with 1,905 more rows, and 8 more variables: Geography_Germany &lt;dbl&gt;,
## #   Geography_Spain &lt;dbl&gt;, Gender_Male &lt;dbl&gt;, HasCrCard_X1 &lt;dbl&gt;,
## #   IsActiveMember_X1 &lt;dbl&gt;, .pred_class &lt;fct&gt;, .pred_0 &lt;dbl&gt;, .pred_1 &lt;dbl&gt;</code></pre>
<p>We have combined the predicted outcome and probabilities into the preprocessed test data set.</p>
</div>
<div id="assessing-model-fit-using-confusion-matrix" class="section level1">
<h1>Assessing model fit using confusion matrix</h1>
<pre class="r"><code>bank_churn_results_rf %&gt;%
  conf_mat(truth = Exited, estimate = .pred_class) %&gt;%
autoplot(type = &#39;heatmap&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
<div id="correct-predictions-of-test-set" class="section level1">
<h1>Correct predictions of test set</h1>
<p>True negative is 1468 customers, who churned. True positive is 157 people, who was a loyal customer and did not churn.</p>
</div>
<div id="classification-error-of-test-set" class="section level1">
<h1>Classification error of test set</h1>
<p>False positive is 68 people, who are predicted as not churned but actually churned. False negative is 222 people, who are predicted as churned but actually not churned and was loyal to bank.</p>
</div>
<div id="combining-models-and-recipe" class="section level1">
<h1>Combining models and recipe</h1>
<pre class="r"><code>bank_churn_wkfl_rf&lt;- workflow() %&gt;%
  add_model(bank_churn_rf_model) %&gt;%
  add_recipe(bank_churn_recipe)
bank_churn_wkfl_rf</code></pre>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor ----------------------------------------------------------------
## 3 Recipe Steps
## 
## * step_corr()
## * step_normalize()
## * step_dummy()
## 
## -- Model -----------------------------------------------------------------------
## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = 4
##   trees = 100
##   min_n = 10
## 
## Computational engine: ranger</code></pre>
</div>
<div id="model-fitting-with-workflow" class="section level1">
<h1>Model fitting with workflow</h1>
<pre class="r"><code>bank_churn_wkfl_fit_rf &lt;- bank_churn_wkfl_rf %&gt;%
  last_fit(split = bank_churn_split)
bank_churn_wkfl_fit_rf %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy binary         0.866 Preprocessor1_Model1
## 2 roc_auc  binary         0.862 Preprocessor1_Model1</code></pre>
<p>We can see here the accuracy of the random forest model is 85.27% and roc_auc is 84.86%</p>
</div>
<div id="collecting-predictions" class="section level1">
<h1>Collecting predictions</h1>
<pre class="r"><code>bank_churn_wkfl_preds_rf &lt;- bank_churn_wkfl_fit_rf %&gt;%
  collect_predictions()
bank_churn_wkfl_preds_rf</code></pre>
<pre><code>## # A tibble: 1,915 x 7
##    id               .pred_0 .pred_1  .row .pred_class Exited .config            
##    &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;  &lt;chr&gt;              
##  1 train/test split   0.965 0.0349     10 0           0      Preprocessor1_Mode~
##  2 train/test split   0.955 0.0448     12 0           0      Preprocessor1_Mode~
##  3 train/test split   0.977 0.0229     19 0           0      Preprocessor1_Mode~
##  4 train/test split   0.985 0.0148     21 0           0      Preprocessor1_Mode~
##  5 train/test split   0.999 0.00125    25 0           0      Preprocessor1_Mode~
##  6 train/test split   0.641 0.359      35 0           1      Preprocessor1_Mode~
##  7 train/test split   0.972 0.0279     36 0           0      Preprocessor1_Mode~
##  8 train/test split   0.646 0.354      40 0           0      Preprocessor1_Mode~
##  9 train/test split   0.411 0.589      43 1           1      Preprocessor1_Mode~
## 10 train/test split   0.925 0.0750     45 0           0      Preprocessor1_Mode~
## # ... with 1,905 more rows</code></pre>
</div>
<div id="confusion-matrix" class="section level1">
<h1>Confusion matrix</h1>
<pre class="r"><code>conf_mat(bank_churn_wkfl_preds_rf, truth = Exited, estimate = .pred_class) %&gt;%
  autoplot(type = &#39;heatmap&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-72-1.png" width="672" />
We could that there is a reduction in both false positive and negative.</p>
</div>
<div id="exploring-custom-metrics" class="section level1">
<h1>Exploring custom metrics</h1>
<pre class="r"><code>bank_churn_metrics_rf &lt;- metric_set(roc_auc, sens, spec, accuracy)
bank_churn_wkfl_preds_rf %&gt;%
bank_churn_metrics_rf(truth = Exited, estimate = .pred_class, .pred_1)</code></pre>
<pre><code>## # A tibble: 4 x 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 sens     binary         0.964
## 2 spec     binary         0.470
## 3 accuracy binary         0.866
## 4 roc_auc  binary         0.138</code></pre>
</div>
<div id="creating-k-fold-cross-validation" class="section level1">
<h1>Creating k-fold cross validation</h1>
<pre class="r"><code>set.seed(222)
bank_churn_folds_rf &lt;- vfold_cv(bank_churn_training, v = 10, strata = Exited)
bank_churn_folds_rf</code></pre>
<pre><code>## #  10-fold cross-validation using stratification 
## # A tibble: 10 x 2
##    splits             id    
##    &lt;list&gt;             &lt;chr&gt; 
##  1 &lt;split [6887/767]&gt; Fold01
##  2 &lt;split [6888/766]&gt; Fold02
##  3 &lt;split [6888/766]&gt; Fold03
##  4 &lt;split [6889/765]&gt; Fold04
##  5 &lt;split [6889/765]&gt; Fold05
##  6 &lt;split [6889/765]&gt; Fold06
##  7 &lt;split [6889/765]&gt; Fold07
##  8 &lt;split [6889/765]&gt; Fold08
##  9 &lt;split [6889/765]&gt; Fold09
## 10 &lt;split [6889/765]&gt; Fold10</code></pre>
<p>We have used 10 times k-fold cross validation to do re-sampling.</p>
</div>
<div id="model-training-with-cross-validation" class="section level1">
<h1>Model training with cross validation</h1>
<pre class="r"><code>bank_churn_rs_fit_rf &lt;-bank_churn_wkfl_rf %&gt;%
  fit_resamples(resamples = bank_churn_folds_rf, metrics = bank_churn_metrics_rf)
bank_churn_rs_fit_rf %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 4 x 6
##   .metric  .estimator  mean     n std_err .config             
##   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy binary     0.863    10 0.00240 Preprocessor1_Model1
## 2 roc_auc  binary     0.845    10 0.00797 Preprocessor1_Model1
## 3 sens     binary     0.964    10 0.00226 Preprocessor1_Model1
## 4 spec     binary     0.450    10 0.0118  Preprocessor1_Model1</code></pre>
<p>We can see above that accuracy of the model is improved to 86.30% from 85.27% and roc-auc is also improved to 85.10% from 84.86% using k-fold cross validation</p>
</div>
<div id="detailed-cross_validation-results" class="section level1">
<h1>Detailed cross_validation results</h1>
<pre class="r"><code>bank_churn_rs_metrics_rf &lt;-bank_churn_rs_fit_rf %&gt;%
  collect_metrics(summarize = FALSE)
bank_churn_rs_metrics_rf </code></pre>
<pre><code>## # A tibble: 40 x 5
##    id     .metric  .estimator .estimate .config             
##    &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
##  1 Fold01 sens     binary         0.971 Preprocessor1_Model1
##  2 Fold01 spec     binary         0.401 Preprocessor1_Model1
##  3 Fold01 accuracy binary         0.858 Preprocessor1_Model1
##  4 Fold01 roc_auc  binary         0.825 Preprocessor1_Model1
##  5 Fold02 sens     binary         0.972 Preprocessor1_Model1
##  6 Fold02 spec     binary         0.441 Preprocessor1_Model1
##  7 Fold02 accuracy binary         0.867 Preprocessor1_Model1
##  8 Fold02 roc_auc  binary         0.877 Preprocessor1_Model1
##  9 Fold03 sens     binary         0.956 Preprocessor1_Model1
## 10 Fold03 spec     binary         0.474 Preprocessor1_Model1
## # ... with 30 more rows</code></pre>
</div>
<div id="summarizing-cross-validation-results" class="section level1">
<h1>Summarizing cross validation results</h1>
<pre class="r"><code>bank_churn_rs_metrics_rf %&gt;%
  group_by(.metric) %&gt;%
  summarize(min= min(.estimate),
            median = median(.estimate),
            max = max(.estimate),
            sd = sd(.estimate))</code></pre>
<pre><code>##         min    median       max       sd
## 1 0.4013158 0.8583557 0.9723127 0.199923</code></pre>
</div>
<div id="hyper-parameter-tuning" class="section level1">
<h1>Hyper parameter tuning</h1>
<pre class="r"><code>bank_churn_rf_tune_model &lt;- rand_forest(mtry = tune(), trees = tune(), min_n = tune()) %&gt;%
  set_engine(&#39;ranger&#39;) %&gt;%
  set_mode(&#39;classification&#39;)
bank_churn_rf_tune_model</code></pre>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Computational engine: ranger</code></pre>
</div>
<div id="creating-tuning-workflow" class="section level1">
<h1>Creating tuning workflow</h1>
<pre class="r"><code>bank_churn_tune_wkfl_rf &lt;- bank_churn_wkfl_rf %&gt;%
  update_model(bank_churn_rf_tune_model)
bank_churn_tune_wkfl_rf</code></pre>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor ----------------------------------------------------------------
## 3 Recipe Steps
## 
## * step_corr()
## * step_normalize()
## * step_dummy()
## 
## -- Model -----------------------------------------------------------------------
## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Computational engine: ranger</code></pre>
</div>
<div id="identifying-hyperparameters" class="section level1">
<h1>Identifying hyperparameters</h1>
<pre class="r"><code>parameters(bank_churn_rf_tune_model)</code></pre>
<pre><code>## Collection of 3 parameters for tuning
## 
##  identifier  type    object
##        mtry  mtry nparam[?]
##       trees trees nparam[+]
##       min_n min_n nparam[+]
## 
## Model parameters needing finalization:
##    # Randomly Selected Predictors (&#39;mtry&#39;)
## 
## See `?dials::finalize` or `?dials::update.parameters` for more information.</code></pre>
</div>
<div id="hyperparameter-tuning-with-cross-validation" class="section level1">
<h1>Hyperparameter tuning with cross validation</h1>
<pre class="r"><code>bank_churn_rf_tuning &lt;- bank_churn_tune_wkfl_rf %&gt;%
  tune_grid(resamples= bank_churn_folds_rf,  metrics = bank_churn_metrics_rf)</code></pre>
<pre><code>## i Creating pre-processing data to finalize unknown parameter: mtry</code></pre>
<pre class="r"><code>bank_churn_rf_tuning</code></pre>
<pre><code>## # Tuning results
## # 10-fold cross-validation using stratification 
## # A tibble: 10 x 4
##    splits             id     .metrics          .notes          
##    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
##  1 &lt;split [6887/767]&gt; Fold01 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  2 &lt;split [6888/766]&gt; Fold02 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  3 &lt;split [6888/766]&gt; Fold03 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  4 &lt;split [6889/765]&gt; Fold04 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  5 &lt;split [6889/765]&gt; Fold05 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  6 &lt;split [6889/765]&gt; Fold06 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  7 &lt;split [6889/765]&gt; Fold07 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  8 &lt;split [6889/765]&gt; Fold08 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
##  9 &lt;split [6889/765]&gt; Fold09 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;
## 10 &lt;split [6889/765]&gt; Fold10 &lt;tibble [40 x 7]&gt; &lt;tibble [0 x 1]&gt;</code></pre>
</div>
<div id="exploring-tuning-results" class="section level1">
<h1>Exploring tuning results</h1>
<pre class="r"><code>bank_churn_rf_tuning %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 40 x 9
##     mtry trees min_n .metric  .estimator  mean     n std_err .config            
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;              
##  1     6   374    30 accuracy binary     0.862    10 0.00257 Preprocessor1_Mode~
##  2     6   374    30 roc_auc  binary     0.848    10 0.00769 Preprocessor1_Mode~
##  3     6   374    30 sens     binary     0.965    10 0.00248 Preprocessor1_Mode~
##  4     6   374    30 spec     binary     0.444    10 0.0122  Preprocessor1_Mode~
##  5     6  1474    21 accuracy binary     0.863    10 0.00259 Preprocessor1_Mode~
##  6     6  1474    21 roc_auc  binary     0.848    10 0.00782 Preprocessor1_Mode~
##  7     6  1474    21 sens     binary     0.965    10 0.00211 Preprocessor1_Mode~
##  8     6  1474    21 spec     binary     0.449    10 0.0119  Preprocessor1_Mode~
##  9    10  1621    33 accuracy binary     0.861    10 0.00211 Preprocessor1_Mode~
## 10    10  1621    33 roc_auc  binary     0.846    10 0.00746 Preprocessor1_Mode~
## # ... with 30 more rows</code></pre>
</div>
<div id="detailed-tuning-results" class="section level1">
<h1>Detailed tuning results</h1>
<pre class="r"><code>bank_churn_rf_tuning %&gt;%
  collect_metrics(summarize = FALSE)</code></pre>
<pre><code>## # A tibble: 400 x 8
##    id      mtry trees min_n .metric  .estimator .estimate .config              
##    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                
##  1 Fold01     6   374    30 sens     binary         0.967 Preprocessor1_Model01
##  2 Fold01     6   374    30 spec     binary         0.434 Preprocessor1_Model01
##  3 Fold01     6   374    30 accuracy binary         0.862 Preprocessor1_Model01
##  4 Fold01     6   374    30 roc_auc  binary         0.831 Preprocessor1_Model01
##  5 Fold02     6   374    30 sens     binary         0.972 Preprocessor1_Model01
##  6 Fold02     6   374    30 spec     binary         0.480 Preprocessor1_Model01
##  7 Fold02     6   374    30 accuracy binary         0.875 Preprocessor1_Model01
##  8 Fold02     6   374    30 roc_auc  binary         0.884 Preprocessor1_Model01
##  9 Fold03     6   374    30 sens     binary         0.953 Preprocessor1_Model01
## 10 Fold03     6   374    30 spec     binary         0.441 Preprocessor1_Model01
## # ... with 390 more rows</code></pre>
</div>
<div id="exploring-tuning-results-1" class="section level1">
<h1>Exploring tuning results</h1>
<pre class="r"><code>bank_churn_rf_tuning %&gt;%
  collect_metrics(summarize = FALSE) %&gt;%
  filter(.metric == &#39;roc_auc&#39;) %&gt;%
  group_by (id) %&gt;%
  summarize( min_roc_auc = min(.estimate),
             median_roc_auc = median(.estimate),
             max_roc_auc = max(.estimate))</code></pre>
<pre><code>##   min_roc_auc median_roc_auc max_roc_auc
## 1   0.7856958      0.8499418   0.8847184</code></pre>
</div>
<div id="viewing-the-best-performing-model" class="section level1">
<h1>Viewing the best performing model</h1>
<pre class="r"><code>bank_churn_rf_tuning %&gt;%
  show_best(metric = &#39;roc_auc&#39;, n =5)</code></pre>
<pre><code>## # A tibble: 5 x 9
##    mtry trees min_n .metric .estimator  mean     n std_err .config              
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     4   839    37 roc_auc binary     0.851    10 0.00798 Preprocessor1_Model06
## 2     3   427    17 roc_auc binary     0.850    10 0.00810 Preprocessor1_Model05
## 3     3  1969    11 roc_auc binary     0.850    10 0.00829 Preprocessor1_Model07
## 4     6   374    30 roc_auc binary     0.848    10 0.00769 Preprocessor1_Model01
## 5     6  1474    21 roc_auc binary     0.848    10 0.00782 Preprocessor1_Model02</code></pre>
<p>Model 8 is the best model</p>
</div>
<div id="selecting-the-best-model" class="section level1">
<h1>Selecting the best model</h1>
<pre class="r"><code>bank_churn_best_rf_model &lt;- bank_churn_rf_tuning %&gt;%
  select_best(metric = &#39;roc_auc&#39;)
bank_churn_best_rf_model </code></pre>
<pre><code>## # A tibble: 1 x 4
##    mtry trees min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1     4   839    37 Preprocessor1_Model06</code></pre>
<p>The best parameters are mtry is 4, trees is 1848 and min_n is 31 and the best model is Preprocessor1_Model08</p>
</div>
<div id="finalizing-the-workflow" class="section level1">
<h1>Finalizing the workflow</h1>
<pre class="r"><code>final_bank_churn_wkfl_rf &lt;- bank_churn_tune_wkfl_rf %&gt;%
  finalize_workflow(bank_churn_best_rf_model)
final_bank_churn_wkfl_rf</code></pre>
<pre><code>## == Workflow ====================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor ----------------------------------------------------------------
## 3 Recipe Steps
## 
## * step_corr()
## * step_normalize()
## * step_dummy()
## 
## -- Model -----------------------------------------------------------------------
## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = 4
##   trees = 839
##   min_n = 37
## 
## Computational engine: ranger</code></pre>
</div>
<div id="model-fitting" class="section level1">
<h1>Model fitting</h1>
<pre class="r"><code>bank_churn_final_fit_rf &lt;- final_bank_churn_wkfl_rf %&gt;%
  last_fit(split = bank_churn_split)
bank_churn_final_fit_rf %&gt;%
  collect_metrics()</code></pre>
<pre><code>## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy binary         0.870 Preprocessor1_Model1
## 2 roc_auc  binary         0.871 Preprocessor1_Model1</code></pre>
<p>We can see above that accuracy and roc-auc (87.05% &amp; 87.99% respectively) are improved compared to the model without tuning.</p>
</div>
<div id="collecting-predictions-1" class="section level1">
<h1>collecting predictions</h1>
<pre class="r"><code>bank_churn_prediction_rf&lt;- bank_churn_final_fit_rf %&gt;%
  collect_predictions()
bank_churn_prediction_rf</code></pre>
<pre><code>## # A tibble: 1,915 x 7
##    id               .pred_0 .pred_1  .row .pred_class Exited .config            
##    &lt;chr&gt;              &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;fct&gt;       &lt;fct&gt;  &lt;chr&gt;              
##  1 train/test split   0.953 0.0472     10 0           0      Preprocessor1_Mode~
##  2 train/test split   0.954 0.0460     12 0           0      Preprocessor1_Mode~
##  3 train/test split   0.976 0.0236     19 0           0      Preprocessor1_Mode~
##  4 train/test split   0.984 0.0158     21 0           0      Preprocessor1_Mode~
##  5 train/test split   0.994 0.00576    25 0           0      Preprocessor1_Mode~
##  6 train/test split   0.564 0.436      35 0           1      Preprocessor1_Mode~
##  7 train/test split   0.954 0.0461     36 0           0      Preprocessor1_Mode~
##  8 train/test split   0.681 0.319      40 0           0      Preprocessor1_Mode~
##  9 train/test split   0.414 0.586      43 1           1      Preprocessor1_Mode~
## 10 train/test split   0.906 0.0943     45 0           0      Preprocessor1_Mode~
## # ... with 1,905 more rows</code></pre>
<pre class="r"><code>conf_mat(bank_churn_prediction_rf, truth = Exited, estimate = .pred_class) %&gt;%
  autoplot(type = &#39;heatmap&#39;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
</div>
<div id="correct-predictions-of-test-set-1" class="section level1">
<h1>Correct predictions of test set</h1>
<p>True negative is 1485 customers, who churned. True positive is 182 people, who was a loyal customer and did not churn.</p>
</div>
<div id="classification-error-of-test-set-1" class="section level1">
<h1>Classification error of test set</h1>
<p>False positive is 51 people, who are predicted as not churned but actually churned. False negative is 197 people, who are predicted as churned but actually not churned and was loyal to bank.</p>
<p>Almost 80% of the customers churned</p>
</div>
